<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat Console</title>
    <link rel="stylesheet" href="ai-chat.css">
</head>
<body>
<div class="page">
    <header class="hero">
        <div class="hero__text">
            <p class="eyebrow">AI Chat Playground</p>
            <h1>웹에서 바로 테스트하는 AI Chat</h1>
            <p class="lede">동기/스트리밍 응답, 승인 헤더, 툴 화이트리스트를 빠르게 조합해보세요. (Ctrl+Enter 전송)</p>
        </div>
        <div class="status-grid">
            <div class="status-card">
                <div class="label">SSE 상태</div>
                <div class="value" id="sseStatus">대기</div>
            </div>
            <div class="status-card">
                <div class="label">마지막 요청</div>
                <div class="value" id="lastRequest">-</div>
            </div>
            <div class="status-card">
                <div class="label">진행 상태</div>
                <div class="value status-inline">
                    <span class="dot" id="loadingDot"></span>
                    <span id="loadingText">대기</span>
                </div>
            </div>
        </div>
    </header>

    <main class="shell">
        <section class="panel">
            <div class="panel__header">
                <div>
                    <p class="eyebrow">요청 구성</p>
                    <h2>세션 · 옵션</h2>
                </div>
                <div class="pill">Blocking API · UUID 세션</div>
            </div>
            <div class="form-grid">
                <label class="field">
                    <span>Session ID</span>
                    <div class="inline-input">
                        <input id="sessionId" type="text" autocomplete="off" aria-label="Session ID">
                        <button class="ghost" id="regenSession" type="button">새로 만들기</button>
                    </div>
                    <small>페이지 로드 시 UUID를 기본 생성합니다.</small>
                </label>
                <label class="field">
                    <span>User ID</span>
                    <input id="userId" type="text" autocomplete="off" aria-label="User ID" value="web-user">
                    <small>기본값은 web-user이며 필요에 따라 수정하세요.</small>
                </label>
                <label class="field full">
                    <span>Tools Allowed</span>
                    <input id="toolsAllowed" type="text" placeholder="listNodes, describeTopology" aria-label="Tools Allowed (comma separated)">
                    <small>콤마로 구분된 툴 목록. 위험 툴 사용 시 승인 체크 필요.</small>
                </label>
                <div class="toggles full">
                    <label class="toggle">
                        <input type="checkbox" id="streamingToggle" checked>
                        <span class="slider"></span>
                        <span class="toggle-label">스트리밍 모드</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" id="approveToggle">
                        <span class="slider"></span>
                        <span class="toggle-label">위험 툴 승인 (X-AI-Approve)</span>
                    </label>
                    <div class="hint">스트리밍 모드 해제 시 동기 `/api/ai/chat` 호출을 사용합니다.</div>
                </div>
            </div>
        </section>

        <section class="panel">
            <div class="panel__header">
                <div>
                    <p class="eyebrow">메시지</p>
                    <h2>프롬프트 입력</h2>
                </div>
                <div class="pill pill--subtle">Ctrl+Enter로 전송</div>
            </div>
            <label class="field full">
                <span>Message</span>
                <textarea id="prompt" rows="4" placeholder="AI에게 보낼 메시지를 입력하세요." aria-label="Prompt"></textarea>
                <small>필수 입력. 세션/유저/툴 설정과 함께 전송됩니다.</small>
            </label>
            <div class="actions">
                <div class="action-buttons">
                    <button class="primary" id="sendBtn" type="button">스트림 전송</button>
                    <button class="ghost" id="stopBtn" type="button" disabled>중단</button>
                </div>
                <div class="action-meta">
                    <span class="kbd">Ctrl</span><span class="plus">+</span><span class="kbd">Enter</span>로 빠르게 전송
                </div>
            </div>
            <div class="alert" id="errorBox" role="alert" hidden></div>
        </section>

        <section class="panel">
            <div class="panel__header">
                <div>
                    <p class="eyebrow">출력</p>
                    <h2>트랜스크립트</h2>
                </div>
                <button class="ghost" id="clearBtn" type="button">초기화</button>
            </div>
            <div class="transcript" id="transcript" aria-live="polite">
                <div class="placeholder">아직 메시지가 없습니다. 프롬프트를 전송해 응답을 받아보세요.</div>
            </div>
            <div class="stream-log">
                <div class="stream-log__header">
                    <div>
                        <p class="eyebrow">스트리밍</p>
                        <h3>실시간 토큰</h3>
                    </div>
                    <span class="pill pill--subtle" id="chunkStatus">대기</span>
                </div>
                <pre class="stream-log__body" id="streamOutput" aria-live="polite"></pre>
            </div>
        </section>
    </main>
</div>
<script src="ai-chat.js"></script>
</body>
</html>
